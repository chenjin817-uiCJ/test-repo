<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>办公椅配件 - 家具卖点字典</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .office-chair-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #667eea;
        }

        .category-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .category-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .items-container {
            display: none;
            margin-top: 40px;
            height: calc(100vh - 200px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .items-container.active {
            display: block;
        }

        .back-button {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #495057;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            display: none; /* 默认隐藏 */
        }

        .back-button:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .category-title-display {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            min-height: 100%;
        }

        .item-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .item-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .item-image {
            width: 100%;
            height: 150px; /* 缩短图片高度 */
            object-fit: cover;
            background: #f8f9fa;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .item-content {
            padding: 20px;
            position: relative;
            min-height: 140px;
            flex: 1; /* 让内容区域占据剩余空间 */
        }

        .item-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding-right: 120px; /* 增加右边距为按钮留出空间 */
            line-height: 1.4;
        }

        .item-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
            padding-right: 120px; /* 增加右边距为按钮留出空间 */
            min-height: 40px;
        }

        .item-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding-right: 120px; /* 增加右边距为按钮留出空间 */
        }

        .feature-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .item-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn {
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
            min-width: 60px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 0.75rem;
            min-width: 50px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .edit-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .edit-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .no-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 3rem;
        }

        /* 编辑模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 99999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        /* 锁定背景滚动的CSS类 */
        .body-scroll-locked {
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
            overflow: hidden !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* 锁定html元素 */
        html.body-scroll-locked {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            height: 80vh;
            max-height: 80vh;
            overflow: hidden !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex !important;
            flex-direction: column !important;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
            pointer-events: auto !important;
            z-index: 100000 !important;
            position: relative;
        }

        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 20px 30px 10px 30px; /* 减少底部padding */
            flex: 1;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            min-height: 0 !important;
            /* 确保模态框内容可以滚动 - 减少footer高度计算 */
            height: calc(80vh - 140px) !important;
            max-height: calc(80vh - 140px) !important;
            position: relative !important;
            /* 强制启用滚动 */
            scroll-behavior: smooth !important;
            -webkit-overflow-scrolling: touch !important;
            /* 确保滚动条可见 */
            scrollbar-width: thin;
            scrollbar-color: #ccc #f5f5f5;
        }

        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #f5f5f5;
            border-radius: 4px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .features-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .feature-input-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-input-item input {
            border: none;
            background: none;
            padding: 0;
            margin: 0;
            font-size: 0.9rem;
            width: auto;
            min-width: 80px;
        }

        .remove-feature {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-feature-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .modal-footer {
            padding: 15px 30px; /* 减少上下padding */
            border-top: 1px solid #e1e5e9;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* 上传区域样式 */
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #5a6fd8;
            background: #f0f2f5;
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: #d4edda;
        }

        .upload-instructions {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .upload-instructions h3 {
            margin-top: 0;
            color: #333;
        }

        .upload-instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .upload-instructions li {
            margin: 5px 0;
            color: #666;
        }

        .upload-instructions table {
            font-size: 0.9rem;
        }

        .upload-instructions th,
        .upload-instructions td {
            text-align: left;
        }

        .page-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .page-actions .btn {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
            }

            .category-card {
                padding: 20px;
            }

            .category-icon {
                font-size: 2.5rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .items-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 配件详情模态框样式 */
        .item-image {
            text-align: center;
            margin-bottom: 20px;
        }

        .item-image img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .item-detail {
            margin-bottom: 15px; /* 减少底部间距 */
        }

        .item-detail h3 {
            color: #333;
            margin-bottom: 8px; /* 减少标题底部间距 */
            font-size: 1.2rem;
        }

        .item-detail p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 0; /* 移除段落底部间距 */
        }

        .detail-section {
            margin-bottom: 15px; /* 减少底部间距 */
        }

        .detail-section h4 {
            color: #333;
            margin-bottom: 8px; /* 减少标题底部间距 */
            font-size: 1.1rem;
        }

        .detail-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .detail-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px; /* 减少顶部间距 */
            padding-top: 15px; /* 减少顶部padding */
            border-top: 1px solid #eee;
        }

        .modal-footer .btn {
            pointer-events: auto !important;
            cursor: pointer !important;
            position: relative !important;
            z-index: 100000 !important;
        }

        .modal-footer button {
            pointer-events: auto !important;
            cursor: pointer !important;
            position: relative !important;
            z-index: 100000 !important;
        }

        .feature-input-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .feature-input-item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .feature-input-item button {
            padding: 8px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .feature-input-item button:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="office-chair-container">
        <!-- 页面头部 -->
        <div class="page-header" style="position: relative;">
            <h1 class="page-title">办公椅配件</h1>
            <p class="page-subtitle">专业办公椅配件分类与详细介绍</p>
            
            <!-- 操作按钮 -->
            <div class="page-actions" id="pageActions">
                <button class="btn btn-secondary" onclick="showAddItemModal()">
                    <i class="fas fa-plus"></i> 新增配件
                </button>
                <button class="btn btn-primary" onclick="showUploadModal()">
                    <i class="fas fa-upload"></i> 上传Excel
                </button>
            </div>
            
        </div>

        <!-- 分类网格 -->
        <div class="categories-grid" id="categoriesGrid">
            <!-- 头枕 -->
            <div class="category-card" onclick="showCategory('headrest')">
                <div class="category-icon">
                    <i class="fas fa-head-side-brain"></i>
                </div>
                <div class="category-title">头枕</div>
                <div class="category-description">提供头部支撑，缓解颈部疲劳，提升坐姿舒适度</div>
            </div>

            <!-- 扶手 -->
            <div class="category-card" onclick="showCategory('armrest')">
                <div class="category-icon">
                    <i class="fas fa-hand-paper"></i>
                </div>
                <div class="category-title">扶手</div>
                <div class="category-description">支撑手臂重量，提供舒适的手臂放置位置</div>
            </div>

            <!-- 靠背 -->
            <div class="category-card" onclick="showCategory('backrest')">
                <div class="category-icon">
                    <i class="fas fa-backward"></i>
                </div>
                <div class="category-title">靠背</div>
                <div class="category-description">支撑背部，维持正确坐姿，减少腰部压力</div>
            </div>

            <!-- 腰托 -->
            <div class="category-card" onclick="showCategory('lumbar')">
                <div class="category-icon">
                    <i class="fas fa-spine"></i>
                </div>
                <div class="category-title">腰托</div>
                <div class="category-description">专门支撑腰部，预防腰椎疾病，提升舒适度</div>
            </div>

            <!-- 坐垫 -->
            <div class="category-card" onclick="showCategory('seat')">
                <div class="category-icon">
                    <i class="fas fa-chair"></i>
                </div>
                <div class="category-title">坐垫</div>
                <div class="category-description">提供舒适的坐感，分散臀部压力，透气排湿</div>
            </div>

            <!-- 底盘 -->
            <div class="category-card" onclick="showCategory('chassis')">
                <div class="category-icon">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="category-title">底盘</div>
                <div class="category-description">椅子核心调节系统，控制高度和倾斜角度</div>
            </div>

            <!-- 五星脚 -->
            <div class="category-card" onclick="showCategory('base')">
                <div class="category-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="category-title">五星脚</div>
                <div class="category-description">椅子支撑底座，提供稳定性和承重能力</div>
            </div>

            <!-- 椅轮 -->
            <div class="category-card" onclick="showCategory('casters')">
                <div class="category-icon">
                    <i class="fas fa-circle"></i>
                </div>
                <div class="category-title">椅轮</div>
                <div class="category-description">实现椅子移动，适应不同地面材质</div>
            </div>
        </div>

        <!-- 配件详情容器 -->
        <div id="itemsContainer" class="items-container">
            <button class="back-button" onclick="showCategories()">
                <i class="fas fa-arrow-left"></i> 返回分类
            </button>
            <h2 id="categoryTitleDisplay" class="category-title-display"></h2>
            <div id="itemsGrid" class="items-grid"></div>
        </div>
    </div>

    <!-- 编辑配件模态框 -->
    <div class="modal" id="editItemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>编辑配件</h2>
                <button class="close-btn" onclick="closeEditItemModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editItemForm">
                    <input type="hidden" id="editItemId">
                    <input type="hidden" id="editItemCategory">
                    <input type="hidden" id="editItemIndex">
                    
                    <div class="form-group">
                        <label for="editItemTitle">配件名称</label>
                        <input type="text" id="editItemTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editItemDescription">配件描述</label>
                        <textarea id="editItemDescription" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editItemImage">图片URL（可选）</label>
                        <input type="url" id="editItemImage" placeholder="https://...">
                    </div>
                    
                    <div class="form-group">
                        <label for="editItemImageFile">本地图片（可选）</label>
                        <input type="file" id="editItemImageFile" accept="image/*">
                        <small class="form-help" style="color: #666; font-size: 0.9rem; margin-top: 5px; display: block;">若同时填写URL并选择本地图片，将优先使用本地图片。</small>
                        <div class="image-preview" id="editItemImagePreview" style="display:none; margin-top: 10px;">
                            <img id="editItemImagePreviewImg" alt="预览" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid #ddd;">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>功能特性</label>
                        <div id="featuresContainer" class="features-input">
                            <!-- 动态生成的功能特性输入框 -->
                        </div>
                        <button type="button" class="add-feature-btn" onclick="addFeatureInput()">
                            <i class="fas fa-plus"></i> 添加特性
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="deleteItem()">
                    <i class="fas fa-trash"></i> 删除
                </button>
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveItem()">
                    <i class="fas fa-save"></i> 保存
                </button>
            </div>
        </div>
    </div>

    <!-- 新增配件模态框 -->
    <div class="modal" id="addItemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>新增配件</h2>
                <button class="close-btn" onclick="closeAddModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addItemForm">
                    <div class="form-group">
                        <label for="addItemCategory">配件分类</label>
                        <select id="addItemCategory" required>
                            <option value="">请选择配件分类</option>
                            <option value="headrest">头枕</option>
                            <option value="armrest">扶手</option>
                            <option value="backrest">靠背</option>
                            <option value="lumbar">腰托</option>
                            <option value="seat">坐垫</option>
                            <option value="chassis">底盘</option>
                            <option value="base">五星脚</option>
                            <option value="casters">椅轮</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="addItemTitle">配件名称</label>
                        <input type="text" id="addItemTitle" required placeholder="例如：可调节扶手">
                    </div>
                    
                    <div class="form-group">
                        <label for="addItemDescription">配件描述</label>
                        <textarea id="addItemDescription" required placeholder="详细描述配件的功能和特点"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="addItemImage">图片URL（可选）</label>
                        <input type="url" id="addItemImage" placeholder="https://...">
                    </div>
                    
                    <div class="form-group">
                        <label for="addItemImageFile">本地图片（可选）</label>
                        <input type="file" id="addItemImageFile" accept="image/*">
                        <small class="form-help" style="color: #666; font-size: 0.9rem; margin-top: 5px; display: block;">若同时填写URL并选择本地图片，将优先使用本地图片。</small>
                        <div class="image-preview" id="addItemImagePreview" style="display:none; margin-top: 10px;">
                            <img id="addItemImagePreviewImg" alt="预览" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid #ddd;">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>功能特性</label>
                        <div id="addFeaturesContainer" class="features-input">
                            <!-- 动态生成的功能特性输入框 -->
                        </div>
                        <button type="button" class="add-feature-btn" onclick="addFeatureInputAdd()">
                            <i class="fas fa-plus"></i> 添加特性
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveNewItem()">
                    <i class="fas fa-save"></i> 保存
                </button>
            </div>
        </div>
    </div>

    <!-- Excel上传模态框 -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>上传配件数据</h2>
                <button class="close-btn" onclick="closeUploadModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #667eea; margin-bottom: 20px;"></i>
                    <p>拖拽 Excel 与图片文件到此处或点击选择文件</p>
                    <p style="color: #ff6b6b; font-size: 14px; margin: 5px 0;">图片大小不能超过3MB</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls,image/*" multiple style="display: none;">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">
                        选择文件 (可多选)
                    </button>
                </div>
                
                <div class="upload-instructions">
                    <h3>上传说明：</h3>
                    <p><strong>方式一：</strong>上传Excel文件（第四列填写图片URL）</p>
                    <p><strong>方式二：</strong>同时上传Excel文件和图片文件（第四列填写图片文件名）</p>
                    
                    <h3>Excel格式说明：</h3>
                    <ul>
                        <li>第一列：配件分类（头枕、扶手、靠背、腰托、坐垫、底盘、五星脚、椅轮）</li>
                        <li>第二列：配件名称</li>
                        <li>第三列：配件描述</li>
                        <li>第四列：图片文件名 或 图片URL（可选）</li>
                        <li>第五列：功能特性（用逗号分隔，可选）</li>
                    </ul>
                    
                    <p><strong>图片文件名说明：</strong>如果第四列填写的是图片文件名（如：armrest1.jpg），请同时选择对应的图片文件上传。系统会自动匹配文件名。</p>
                    <p><strong>示例：</strong></p>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <tr style="background: #f8f9fa;">
                            <th style="border: 1px solid #dee2e6; padding: 8px;">分类</th>
                            <th style="border: 1px solid #dee2e6; padding: 8px;">名称</th>
                            <th style="border: 1px solid #dee2e6; padding: 8px;">描述</th>
                            <th style="border: 1px solid #dee2e6; padding: 8px;">图片文件名/URL</th>
                            <th style="border: 1px solid #dee2e6; padding: 8px;">特性</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #dee2e6; padding: 8px;">扶手</td>
                            <td style="border: 1px solid #dee2e6; padding: 8px;">可调节扶手</td>
                            <td style="border: 1px solid #dee2e6; padding: 8px;">支持多维度调节的扶手系统</td>
                            <td style="border: 1px solid #dee2e6; padding: 8px;">https://...</td>
                            <td style="border: 1px solid #dee2e6; padding: 8px;">高度调节,宽度调节,角度调节</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 配件详情模态框 -->
    <div class="modal" id="itemDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="itemDetailTitle"></h2>
                <button class="close-btn" onclick="event.stopPropagation(); closeItemDetailModal();">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="itemDetailBody">
                <!-- 详情内容将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="script.js"></script>
    <script>
        
        
        
        
        
        
        
        
        
        
        
        // 全局函数定义（必须在数据定义之前）
        window.showCategory = function(categoryKey) {
            console.log('showCategory函数被调用，分类:', categoryKey);
            
            const categoryData = window.officeChairData[categoryKey];
            if (!categoryData) {
                console.error('找不到分类数据:', categoryKey);
                return;
            }

            console.log('找到分类数据:', categoryData);

            // 设置当前分类
            window.currentCategory = categoryKey;

            // 隐藏分类网格
            const categoriesGrid = document.getElementById('categoriesGrid');
            if (categoriesGrid) {
                categoriesGrid.style.display = 'none';
                console.log('分类网格已隐藏');
            } else {
                console.error('找不到categoriesGrid元素');
            }
            
            // 显示配件容器
            const itemsContainer = document.getElementById('itemsContainer');
            if (itemsContainer) {
                itemsContainer.classList.add('active');
                console.log('配件容器已显示');
            } else {
                console.error('找不到itemsContainer元素');
            }
            
            // 显示返回按钮
            const backButton = document.querySelector('.back-button');
            if (backButton) {
                backButton.style.display = 'block';
                console.log('返回按钮已显示');
            } else {
                console.error('找不到返回按钮');
            }
            
            // 设置标题
            const categoryTitleDisplay = document.getElementById('categoryTitleDisplay');
            if (categoryTitleDisplay) {
                categoryTitleDisplay.textContent = categoryData.title;
                console.log('标题已设置:', categoryData.title);
            } else {
                console.error('找不到categoryTitleDisplay元素');
            }
            
            // 渲染配件卡片
            window.renderItems(categoryData.items);
            console.log('配件卡片已渲染');
            
            // 在分类详情页面隐藏功能按钮
            setTimeout(() => {
                // 隐藏功能按钮
                const pageActions = document.getElementById('pageActions');
                if (pageActions) {
                    pageActions.style.display = 'none';
                    console.log('分类详情页面隐藏功能按钮');
                }
            }, 100);
        };

        window.showCategories = function() {
            document.getElementById('categoriesGrid').style.display = 'grid';
            document.getElementById('itemsContainer').classList.remove('active');
            
            // 隐藏返回按钮
            const backButton = document.querySelector('.back-button');
            if (backButton) {
                backButton.style.display = 'none';
            }
            
            // 显示功能按钮
            const pageActions = document.getElementById('pageActions');
            if (pageActions) {
                pageActions.style.display = 'flex';
                console.log('分类列表页面显示功能按钮');
            }
        };

        window.renderItems = function(items) {
            const itemsGrid = document.getElementById('itemsGrid');
            const itemsContainer = document.getElementById('itemsContainer');
            if (!itemsGrid || !itemsContainer) return;
            
            // 保存当前滚动位置
            const scrollTop = itemsContainer.scrollTop;
            
            itemsGrid.innerHTML = '';
            
            if (items && items.length > 0) {
                items.forEach((item, index) => {
                    const itemCard = document.createElement('div');
                    itemCard.className = 'item-card';
                    itemCard.style.cursor = 'pointer';
                    itemCard.onclick = function() {
                        showItemDetail(window.currentCategory, index);
                    };
                    itemCard.innerHTML = `
                        <div class="item-image">
                            ${item.image ? `<img src="${item.image}" alt="${item.title}" onerror="this.style.display='none'">` : ''}
                        </div>
                        <div class="item-content">
                            <h3 class="item-title">${item.title}</h3>
                            <p class="item-description">${item.description}</p>
                            ${item.features && item.features.length > 0 ? `
                                <div class="item-features">
                                    ${item.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                    itemsGrid.appendChild(itemCard);
                });
            }
            
            // 恢复滚动位置并确保滚动功能正常
            setTimeout(() => {
                itemsContainer.scrollTop = scrollTop;
                // 确保滚动功能正常
                itemsContainer.style.overflowY = 'auto';
                itemsContainer.style.overflowX = 'hidden';
                console.log('滚动位置已恢复:', scrollTop);
            }, 0);
        };

        // 办公椅配件数据（全局变量）
        window.officeChairData = {
            headrest: {
                title: '头枕',
                items: [
                    {
                        title: '固定头枕',
                        description: '位置固定的头枕设计，提供稳定的头部支撑，适合长时间办公使用。采用人体工学设计，有效缓解颈部疲劳。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['固定位置', '颈部支撑', '人体工学', '长时间使用']
                    },
                    {
                        title: '可调节头枕',
                        description: '支持高度和角度调节的头枕，可根据个人身高和使用习惯进行调整，提供个性化的舒适体验。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['高度调节', '角度调节', '个性化', '舒适体验']
                    }
                ]
            },
            armrest: {
                title: '扶手',
                items: [
                    {
                        title: '固定扶手',
                        description: '位置固定的扶手设计，提供稳定的手臂支撑。适合对扶手位置要求不高的用户，结构简单可靠。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['固定位置', '稳定支撑', '结构简单', '可靠耐用']
                    },
                    {
                        title: '翻转扶手',
                        description: '可向上翻转收起的扶手设计，节省空间，方便进出。支持扶手面角度调节，适应不同使用场景。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['翻转收起', '节省空间', '角度调节', '方便进出']
                    },
                    {
                        title: '可调节扶手',
                        description: '支持多维度调节的扶手系统，包括高度、宽度、深度和角度调节，提供最舒适的手臂支撑位置。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['高度调节', '宽度调节', '深度调节', '角度调节', '3D调节']
                    }
                ]
            },
            backrest: {
                title: '靠背',
                items: [
                    {
                        title: '整背靠背',
                        description: '一体成型的靠背设计，提供完整的背部支撑。支持高度调节，适应不同身高用户需求。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['一体成型', '完整支撑', '高度调节', '适应性强']
                    },
                    {
                        title: '分背靠背',
                        description: '分离式靠背设计，上下部分可独立调节，提供更精细的背部支撑，适合对坐姿有特殊要求的用户。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['分离设计', '独立调节', '精细支撑', '个性化']
                    }
                ]
            },
            lumbar: {
                title: '腰托',
                items: [
                    {
                        title: '独立腰托',
                        description: '独立的腰部支撑系统，支持高度和压力调节。有效缓解腰部疲劳，预防腰椎疾病。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['独立支撑', '高度调节', '压力调节', '腰椎保护']
                    },
                    {
                        title: '特色腰托',
                        description: '具有特殊功能的腰托设计，如记忆棉材质、按摩功能等，提供更高级的腰部护理体验。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['记忆棉', '按摩功能', '高级护理', '舒适体验']
                    }
                ]
            },
            seat: {
                title: '坐垫',
                items: [
                    {
                        title: '海绵坐垫',
                        description: '采用优质海绵材料制作的坐垫，提供舒适的坐感。包括再生棉、原生棉和定型海绵等多种类型。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['海绵材质', '舒适坐感', '再生棉', '原生棉', '定型海绵']
                    },
                    {
                        title: '网布坐垫',
                        description: '采用透气网布材料制作的坐垫，具有良好的透气性和排湿性，适合长时间使用。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['网布材质', '透气性好', '排湿性强', '长时间使用']
                    }
                ]
            },
            chassis: {
                title: '底盘',
                items: [
                    {
                        title: '圆托底盘',
                        description: '经典的圆形托盘底盘设计，结构简单可靠，适合基础办公需求。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['圆形托盘', '结构简单', '可靠耐用', '基础功能']
                    },
                    {
                        title: '逍遥托底盘',
                        description: '支持摇摆功能的底盘设计，工作之余可以放松摇摆，缓解疲劳。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['摇摆功能', '放松体验', '缓解疲劳', '休闲办公']
                    },
                    {
                        title: '倾仰托盘底盘',
                        description: '支持多档位倾仰调节的底盘系统，包括无极调节、原位锁定、多档锁定等多种类型。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['倾仰调节', '无极调节', '原位锁定', '多档锁定', '自调节', '快调张力']
                    }
                ]
            },
            base: {
                title: '五星脚',
                items: [
                    {
                        title: '尼龙五星脚',
                        description: '采用高强度尼龙材料制作的五星脚，重量轻、强度高，包括拆单脚和一体式设计。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['尼龙材质', '重量轻', '强度高', '拆单脚', '一体式']
                    },
                    {
                        title: '铁质五星脚',
                        description: '采用优质钢材制作的五星脚，承重能力强，经久耐用。支持拆装和一体式设计，表面处理包括电镀和喷漆。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['铁质材质', '承重能力强', '经久耐用', '拆装设计', '电镀处理', '喷漆处理']
                    },
                    {
                        title: '铝合金五星脚',
                        description: '采用轻质铝合金制作的五星脚，兼具强度和轻量化特性。表面处理包括抛光和喷漆工艺。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['铝合金材质', '轻量化', '强度高', '抛光处理', '喷漆处理']
                    }
                ]
            },
            casters: {
                title: '椅轮',
                items: [
                    {
                        title: 'PP轮',
                        description: '聚丙烯材质的椅轮，适合地毯和硬质地面使用，滚动顺畅，价格经济。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['PP材质', '地毯适用', '硬质地面', '滚动顺畅', '价格经济']
                    },
                    {
                        title: 'PU轮',
                        description: '聚氨酯材质的椅轮，静音效果佳，对地面保护性好，适合各种地面材质使用。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['PU材质', '静音效果', '地面保护', '多材质适用']
                    },
                    {
                        title: '尼龙轮',
                        description: '高强度尼龙材质的椅轮，承重能力强，耐磨性好，适合高负荷使用环境。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['尼龙材质', '高承重', '耐磨性好', '高负荷使用']
                    },
                    {
                        title: '冰刀轮',
                        description: '特殊的冰刀式设计，适合光滑地面使用，移动更加流畅，外观时尚。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['冰刀设计', '光滑地面', '流畅移动', '时尚外观']
                    },
                    {
                        title: '太空轮',
                        description: '高科技太空轮设计，具有超强承重能力和极佳的耐磨性，适合专业办公环境。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['高科技设计', '超强承重', '极佳耐磨', '专业办公']
                    },
                    {
                        title: '刹车轮',
                        description: '带有刹车功能的椅轮，可以锁定位置防止滑动，适合需要固定位置的办公场景。',
                        image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop',
                        features: ['刹车功能', '位置锁定', '防滑动', '固定位置']
                    }
                ]
            }
        };

        // 显示分类
        function showCategories() {
            document.getElementById('categoriesGrid').style.display = 'grid';
            document.getElementById('itemsContainer').classList.remove('active');
        }


        // 渲染配件卡片
        function renderItems(items) {
            const itemsGrid = document.getElementById('itemsGrid');
            itemsGrid.innerHTML = '';

            items.forEach((item, index) => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                
                const imageHtml = item.image ? 
                    `<img src="${item.image}" alt="${item.title}" class="item-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` :
                    '';
                
                const noImageHtml = `
                    <div class="no-image" style="${item.image ? 'display:none;' : 'display:flex;'}">
                        <i class="fas fa-image"></i>
                    </div>
                `;

                const featuresHtml = item.features.map(feature => 
                    `<span class="feature-tag">${feature}</span>`
                ).join('');

                itemCard.innerHTML = `
                    ${imageHtml}
                    ${noImageHtml}
                    <div class="item-content">
                        <div class="item-actions">
                            <button class="edit-btn" onclick="editItem('${currentCategory}', ${index})">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="delete-btn" onclick="deleteItemConfirm('${currentCategory}', ${index})">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                        <h3 class="item-title">${item.title}</h3>
                        <p class="item-description">${item.description}</p>
                        <div class="item-features">
                            ${featuresHtml}
                        </div>
                    </div>
                `;

                itemsGrid.appendChild(itemCard);
            });
        }

        // 当前选中的分类
        let currentCategory = '';


        // 编辑配件
        function editItem(categoryKey, itemIndex) {
            const categoryData = officeChairData[categoryKey];
            const item = categoryData.items[itemIndex];
            
            if (!item) return;

            // 填充表单数据
            document.getElementById('editItemId').value = item.id || '';
            document.getElementById('editItemCategory').value = categoryKey;
            document.getElementById('editItemIndex').value = itemIndex;
            document.getElementById('editItemTitle').value = item.title;
            document.getElementById('editItemDescription').value = item.description;
            document.getElementById('editItemImage').value = item.image || '';

            // 重置本地图片文件输入
            const imageFileInput = document.getElementById('editItemImageFile');
            if (imageFileInput) {
                imageFileInput.value = '';
            }

            // 重置图片预览
            const preview = document.getElementById('editItemImagePreview');
            const previewImg = document.getElementById('editItemImagePreviewImg');
            if (preview && previewImg) {
                // 清理之前的URL
                if (previewImg.dataset.objUrl) {
                    URL.revokeObjectURL(previewImg.dataset.objUrl);
                    delete previewImg.dataset.objUrl;
                }
                previewImg.src = '';
                preview.style.display = 'none';
            }

            // 渲染功能特性输入框
            renderFeatureInputs(item.features || []);

            // 设置本地图片上传事件监听器
            console.log('设置编辑配件图片上传功能...');
            setupEditItemImageUpload();

            // 显示模态框
            const modal = document.getElementById('editItemModal');
            modal.classList.add('show');
            modal.style.display = 'flex';
            modal.style.pointerEvents = 'auto';
        }

        // 渲染功能特性输入框
        function renderFeatureInputs(features) {
            const container = document.getElementById('featuresContainer');
            container.innerHTML = '';

            features.forEach((feature, index) => {
                const featureItem = document.createElement('div');
                featureItem.className = 'feature-input-item';
                featureItem.innerHTML = `
                    <input type="text" value="${feature}" placeholder="输入特性">
                    <button type="button" class="remove-feature" onclick="removeFeatureInput(this)">×</button>
                `;
                container.appendChild(featureItem);
            });

            // 如果没有特性，添加一个空的输入框
            if (features.length === 0) {
                addFeatureInput();
            }
        }

        // 添加功能特性输入框
        function addFeatureInput() {
            const container = document.getElementById('featuresContainer');
            const featureItem = document.createElement('div');
            featureItem.className = 'feature-input-item';
            featureItem.innerHTML = `
                <input type="text" placeholder="输入特性">
                <button type="button" class="remove-feature" onclick="removeFeatureInput(this)">×</button>
            `;
            container.appendChild(featureItem);
        }

        // 移除功能特性输入框
        function removeFeatureInput(button) {
            button.parentElement.remove();
        }

        // 设置编辑配件图片上传功能
        function setupEditItemImageUpload() {
            console.log('开始设置编辑配件图片上传功能...');
            const imageFileInput = document.getElementById('editItemImageFile');
            const preview = document.getElementById('editItemImagePreview');
            const previewImg = document.getElementById('editItemImagePreviewImg');
            
            console.log('找到的元素:', { imageFileInput, preview, previewImg });
            
            if (imageFileInput && preview && previewImg) {
                console.log('所有元素都找到了，开始设置事件监听器...');
                // 移除之前的事件监听器
                imageFileInput.removeEventListener('change', handleEditItemImageChange);
                
                // 添加新的事件监听器
                imageFileInput.addEventListener('change', handleEditItemImageChange);
                
                function handleEditItemImageChange(e) {
                    console.log('编辑配件图片文件选择事件触发');
                    const file = e.target.files && e.target.files[0];
                    console.log('选择的文件:', file);
                    if (file) {
                        // 使用URL.createObjectURL创建预览（更高效）
                        const objUrl = URL.createObjectURL(file);
                        previewImg.src = objUrl;
                        preview.style.display = 'block';
                        
                        // 清理之前的URL
                        if (previewImg.dataset.objUrl) {
                            URL.revokeObjectURL(previewImg.dataset.objUrl);
                        }
                        previewImg.dataset.objUrl = objUrl;
                    } else {
                        // 清理URL并隐藏预览
                        if (previewImg.dataset.objUrl) {
                            URL.revokeObjectURL(previewImg.dataset.objUrl);
                            delete previewImg.dataset.objUrl;
                        }
                        previewImg.src = '';
                        preview.style.display = 'none';
                    }
                }
            }
        }

        // 保存配件
        function saveItem() {
            const categoryKey = document.getElementById('editItemCategory').value;
            const itemIndex = parseInt(document.getElementById('editItemIndex').value);
            const title = document.getElementById('editItemTitle').value.trim();
            const description = document.getElementById('editItemDescription').value.trim();
            const imageUrl = document.getElementById('editItemImage').value.trim();
            const imageFileInput = document.getElementById('editItemImageFile');
            const imageFile = imageFileInput ? imageFileInput.files[0] : null;

            if (!title || !description) {
                alert('请填写配件名称和描述');
                return;
            }

            // 获取功能特性
            const featureInputs = document.querySelectorAll('#featuresContainer .feature-input-item input');
            const features = Array.from(featureInputs)
                .map(input => input.value.trim())
                .filter(feature => feature);

            // 处理图片：优先使用本地图片，其次使用URL
            let finalImageUrl = imageUrl;
            
            if (imageFile) {
                // 如果有本地图片文件，转换为base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    finalImageUrl = e.target.result;
                    saveItemWithImage();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // 没有本地图片，直接保存
                saveItemWithImage();
            }
            
            function saveItemWithImage() {
                // 更新数据
                const categoryData = window.officeChairData[categoryKey];
                const item = categoryData.items[itemIndex];
                
                item.title = title;
                item.description = description;
                item.image = finalImageUrl;
                item.features = features;

                // 保存到localStorage
                window.saveDataToStorage();

                // 重新渲染
                window.renderItems(categoryData.items);
                
                // 关闭模态框
                closeEditItemModal();
                
                alert('保存成功');
            }
        }

        // 删除配件确认
        function deleteItemConfirm(categoryKey, itemIndex) {
            const categoryData = window.officeChairData[categoryKey];
            const item = categoryData.items[itemIndex];
            
            if (!confirm(`确定要删除"${item.title}"吗？此操作无法撤销。`)) {
                return;
            }

            // 删除配件
            categoryData.items.splice(itemIndex, 1);
            
            // 保存到localStorage
            window.saveDataToStorage();
            
            // 重新渲染
            window.renderItems(categoryData.items);
            
            alert('删除成功');
        }

        // 删除配件（从模态框）
        function deleteItem() {
            const categoryKey = document.getElementById('editItemCategory').value;
            const itemIndex = parseInt(document.getElementById('editItemIndex').value);
            
            deleteItemConfirm(categoryKey, itemIndex);
            closeEditItemModal();
        }

        // 关闭编辑模态框
        function closeEditModal() {
            const modal = document.getElementById('editItemModal');
            modal.classList.remove('show');
            modal.style.display = 'none';
            modal.style.pointerEvents = '';
            
            // 清理图片预览的URL
            const previewImg = document.getElementById('editItemImagePreviewImg');
            if (previewImg && previewImg.dataset.objUrl) {
                URL.revokeObjectURL(previewImg.dataset.objUrl);
                delete previewImg.dataset.objUrl;
            }
        }

        // 显示新增配件模态框
        function showAddItemModal() {
            // 重置表单
            document.getElementById('addItemForm').reset();
            document.getElementById('addFeaturesContainer').innerHTML = '';
            addFeatureInputAdd(); // 添加一个空的特性输入框
            
            // 重置图片预览
            const preview = document.getElementById('addItemImagePreview');
            const previewImg = document.getElementById('addItemImagePreviewImg');
            if (preview && previewImg) {
                // 清理之前的URL
                if (previewImg.dataset.objUrl) {
                    URL.revokeObjectURL(previewImg.dataset.objUrl);
                    delete previewImg.dataset.objUrl;
                }
                previewImg.src = '';
                preview.style.display = 'none';
            }
            
            // 设置本地图片上传事件监听器
            setupAddItemImageUpload();
            
            // 显示模态框
            const modal = document.getElementById('addItemModal');
            modal.classList.add('show');
            modal.style.display = 'flex';
            modal.style.pointerEvents = 'auto';
        }

        // 关闭新增配件模态框
        function closeAddModal() {
            const modal = document.getElementById('addItemModal');
            modal.classList.remove('show');
            modal.style.display = 'none';
            modal.style.pointerEvents = '';
            
            // 清理图片预览的URL
            const previewImg = document.getElementById('addItemImagePreviewImg');
            if (previewImg && previewImg.dataset.objUrl) {
                URL.revokeObjectURL(previewImg.dataset.objUrl);
                delete previewImg.dataset.objUrl;
            }
        }

        // 为新增模态框添加特性输入框
        function addFeatureInputAdd() {
            const container = document.getElementById('addFeaturesContainer');
            const featureItem = document.createElement('div');
            featureItem.className = 'feature-input-item';
            featureItem.innerHTML = `
                <input type="text" placeholder="输入特性">
                <button type="button" class="remove-feature" onclick="removeFeatureInput(this)">×</button>
            `;
            container.appendChild(featureItem);
        }

        // 设置新增配件图片上传功能
        function setupAddItemImageUpload() {
            const imageFileInput = document.getElementById('addItemImageFile');
            const preview = document.getElementById('addItemImagePreview');
            const previewImg = document.getElementById('addItemImagePreviewImg');
            
            if (imageFileInput && preview && previewImg) {
                // 移除之前的事件监听器
                imageFileInput.removeEventListener('change', handleAddItemImageChange);
                
                // 添加新的事件监听器
                imageFileInput.addEventListener('change', handleAddItemImageChange);
                
                function handleAddItemImageChange(e) {
                    const file = e.target.files && e.target.files[0];
                    if (file) {
                        // 使用URL.createObjectURL创建预览（更高效）
                        const objUrl = URL.createObjectURL(file);
                        previewImg.src = objUrl;
                        preview.style.display = 'block';
                        
                        // 清理之前的URL
                        if (previewImg.dataset.objUrl) {
                            URL.revokeObjectURL(previewImg.dataset.objUrl);
                        }
                        previewImg.dataset.objUrl = objUrl;
                    } else {
                        // 清理URL并隐藏预览
                        if (previewImg.dataset.objUrl) {
                            URL.revokeObjectURL(previewImg.dataset.objUrl);
                            delete previewImg.dataset.objUrl;
                        }
                        previewImg.src = '';
                        preview.style.display = 'none';
                    }
                }
            }
        }

        // 保存新配件
        function saveNewItem() {
            const category = document.getElementById('addItemCategory').value;
            const title = document.getElementById('addItemTitle').value.trim();
            const description = document.getElementById('addItemDescription').value.trim();
            const imageUrl = document.getElementById('addItemImage').value.trim();
            const imageFile = document.getElementById('addItemImageFile').files[0];

            if (!category || !title || !description) {
                alert('请填写完整信息');
                return;
            }

            // 获取功能特性
            const featureInputs = document.querySelectorAll('#addFeaturesContainer .feature-input-item input');
            const features = Array.from(featureInputs)
                .map(input => input.value.trim())
                .filter(feature => feature);

            // 处理图片：优先使用本地图片，其次使用URL
            let finalImageUrl = imageUrl;
            
            if (imageFile) {
                // 如果有本地图片文件，转换为base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    finalImageUrl = e.target.result;
                    saveItemWithImage();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // 没有本地图片，直接保存
                saveItemWithImage();
            }
            
            function saveItemWithImage() {
                // 创建新配件
                const newItem = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    image: finalImageUrl,
                    features: features
                };

                // 添加到对应分类
                const categoryData = officeChairData[category];
                if (categoryData) {
                    categoryData.items.push(newItem);
                    
                    // 保存到localStorage
                    saveDataToStorage();
                    
                    // 如果当前正在查看这个分类，重新渲染
                    if (currentCategory === category) {
                        renderItems(categoryData.items);
                    }
                    
                    closeAddModal();
                    alert('新增成功');
                }
            }
        }

        // 显示Excel上传模态框
        function showUploadModal() {
            console.log('showUploadModal函数被调用');
            const modal = document.getElementById('uploadModal');
            console.log('uploadModal元素:', modal);
            
            if (modal) {
            modal.classList.add('show');
            modal.style.display = 'flex';
            modal.style.pointerEvents = 'auto';
                modal.style.zIndex = '9999';
                console.log('模态框样式已设置');
            
            // 设置文件输入事件监听器
                try {
            setupFileUpload();
                    console.log('setupFileUpload已调用');
                } catch (error) {
                    console.error('setupFileUpload错误:', error);
                }
            } else {
                console.error('uploadModal元素不存在');
            }
        }

        // 关闭Excel上传模态框
        function closeUploadModal() {
            const modal = document.getElementById('uploadModal');
            modal.classList.remove('show');
            modal.style.display = 'none';
            modal.style.pointerEvents = '';
        }

        // 全局变量存储上传的文件
        // pendingExcelFile 和 uploadedImageMap 已在 script.js 中声明

        // 分离Excel和图片文件
        function splitExcelAndImages(files) {
            let excelFile = null;
            const imageFiles = [];
            for (const f of files) {
                if (/\.(xlsx|xls)$/i.test(f.name)) excelFile = f;
                else if (f.type.startsWith('image/')) imageFiles.push(f);
            }
            return { excelFile, imageFiles };
        }

    // 图片压缩函数
    function compressImage(file, filename, callback) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
            // 计算压缩后的尺寸
            let { width, height } = img;
            const maxWidth = 800;
            const maxHeight = 600;
            const maxSize = 500 * 1024; // 500KB
            
            // 按比例缩放
            if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width = width * ratio;
                height = height * ratio;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            // 绘制压缩后的图片
            ctx.drawImage(img, 0, 0, width, height);
            
            // 尝试不同的质量直到文件大小合适
            let quality = 0.8;
            let dataUrl;
            
            do {
                dataUrl = canvas.toDataURL('image/jpeg', quality);
                if (dataUrl.length <= maxSize) {
                    console.log(`图片 ${filename} 压缩完成，质量: ${quality}, 大小: ${(dataUrl.length/1024).toFixed(1)}KB`);
                    callback(dataUrl);
                    return;
                }
                quality -= 0.1;
            } while (quality > 0.1);
            
            // 如果还是太大，尝试进一步缩小尺寸
            if (dataUrl.length > maxSize) {
                const sizeRatio = Math.sqrt(maxSize / dataUrl.length);
                width = width * sizeRatio;
                height = height * sizeRatio;
                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);
                dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                console.log(`图片 ${filename} 进一步压缩，最终大小: ${(dataUrl.length/1024).toFixed(1)}KB`);
            }
            
            callback(dataUrl);
        };
        
        img.onerror = function() {
            console.error(`图片 ${filename} 加载失败`);
            callback(null);
        };
        
        // 读取文件
        const reader = new FileReader();
        reader.onload = function(e) {
            img.src = e.target.result;
        };
        reader.onerror = function() {
            console.error(`图片 ${filename} 读取失败`);
            callback(null);
        };
        reader.readAsDataURL(file);
    }

    // 构建文件名到ObjectURL的映射
    function buildUploadedImageMap(imageFiles) {
        uploadedImageMap = {};
        const readers = imageFiles.map(img => new Promise((resolve) => {
            const filename = img.name;
            const lower = filename.toLowerCase();
            const noExt = lower.replace(/\.[a-z0-9]+$/, '');
            const compact = lower.replace(/\s+/g, '');
            
            // 检查文件大小（限制为3MB，超过则压缩）
            if (img.size > 3 * 1024 * 1024) {
                console.warn(`图片 ${filename} 太大 (${(img.size/1024/1024).toFixed(1)}MB)，将跳过`);
                resolve();
                return;
            }
            
            // 使用图片压缩功能
            compressImage(img, filename, (compressedDataUrl) => {
                if (compressedDataUrl) {
                    uploadedImageMap[lower] = compressedDataUrl;
                    uploadedImageMap[noExt] = compressedDataUrl;
                    uploadedImageMap[compact] = compressedDataUrl;
                    console.log(`图片 ${filename} 已压缩并处理，映射到: [${lower}, ${noExt}, ${compact}]`);
                }
                resolve();
            });
        }));
        return Promise.all(readers);
        }

        // 设置文件上传功能
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            // 移除之前的事件监听器（如果有的话）
            fileInput.removeEventListener('change', handleFileUpload);
            uploadArea.removeEventListener('dragover', handleDragOver);
            uploadArea.removeEventListener('dragleave', handleDragLeave);
            uploadArea.removeEventListener('drop', handleDrop);
            
            // 添加新的事件监听器
            fileInput.addEventListener('change', handleFileUpload);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
        }

        // 处理文件上传
        async function handleFileUpload(e) {
            const input = e.target;
            const files = Array.from(input.files || []);
            if (!files.length) return;

            const { excelFile, imageFiles } = splitExcelAndImages(files);
            if (imageFiles.length) {
                await buildUploadedImageMap(imageFiles); // 确保图片映射已就绪再解析Excel
            }
            if (excelFile) {
                pendingExcelFile = excelFile;
                processExcelFile(pendingExcelFile);
            } else if (imageFiles.length) {
                alert(`已添加 ${imageFiles.length} 张图片，请再选择Excel文件。`);
            }

            // 清空选择器值，保证下次即使选择相同文件也会触发change
            try { input.value = ''; } catch (_) {}
        }

        // 处理拖拽悬停
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        // 处理拖拽离开
        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        // 处理拖拽放置
        async function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files || []);
            if (!files.length) return;
            const { excelFile, imageFiles } = splitExcelAndImages(files);
            if (imageFiles.length) {
                await buildUploadedImageMap(imageFiles);
            }
            if (excelFile) {
                pendingExcelFile = excelFile;
                processExcelFile(pendingExcelFile);
            } else if (imageFiles.length) {
                alert('已拖入图片，请再拖入或选择Excel文件。');
            }
        }

        // 处理Excel文件
        function processExcelFile(file) {
            if (!file.name.match(/\.(xlsx|xls)$/)) {
                alert('请选择Excel文件（.xlsx或.xls格式）');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    const added = parseExcelData(jsonData);
                    if (added.length > 0) {
                        // 保存到localStorage
                        saveDataToStorage();
                        
                        closeUploadModal();
                        alert(`成功导入 ${added.length} 个配件数据！${Object.keys(uploadedImageMap).length ? '\n图片：已匹配本地文件（如有同名）' : ''}`);
                        
                        // 如果当前正在查看导入的分类，重新渲染
                        if (currentCategory && officeChairData[currentCategory]) {
                            renderItems(officeChairData[currentCategory].items);
                        }
                        
                        // 重置Excel选择
                        pendingExcelFile = null;
                    } else {
                        alert('Excel文件中没有找到有效的配件数据，请检查数据格式');
                    }
                } catch (error) {
                    console.error('Excel解析错误:', error);
                    alert('Excel文件解析失败，请检查文件格式');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // 解析Excel数据
        function parseExcelData(data) {
            const added = [];
            
            if (!data || data.length === 0) return added;
            
            // 中文分类名到英文key的映射
            const categoryMapping = {
                '头枕': 'headrest',
                '扶手': 'armrest',
                '靠背': 'backrest',
                '腰托': 'lumbar',
                '坐垫': 'seat',
                '底盘': 'chassis',
                '五星脚': 'base',
                '椅轮': 'casters'
            };
            
            // 跳过标题行，从第二行开始处理数据
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length < 3) continue;
                
                const categoryText = (row[0] || '').toString().trim();
                const title = (row[1] || '').toString().trim();
                const description = (row[2] || '').toString().trim();
                const image = (row[3] || '').toString().trim();
                const featuresStr = (row[4] || '').toString().trim();
                
                if (!categoryText || !title || !description) continue;
                
                // 将中文分类名转换为英文key
                const category = categoryMapping[categoryText];
                
                // 验证分类是否有效
                if (!category || !officeChairData[category]) {
                    console.warn(`无效的分类: ${categoryText}`);
                    continue;
                }
                
                // 解析功能特性
                const features = featuresStr ? 
                    featuresStr.split(/[,，]/).map(f => f.trim()).filter(f => f) : 
                    [];
                
                // 图片匹配逻辑：若第四列是文件名并且用户上传了对应图片，则使用本地对象URL；否则按URL处理
                let resolvedImageUrl = '';
                if (image) {
                    const raw = image.toString().trim();
                    const base = decodeURI(raw).split(/[\\/]/).pop().trim();
                    const lower = base.toLowerCase();
                    const noExt = lower.replace(/\.[a-z0-9]+$/, '');
                    const compact = lower.replace(/\s+/g, '');
                    const candidates = [lower, noExt, compact];
                    for (const c of candidates) {
                        if (uploadedImageMap[c]) { resolvedImageUrl = uploadedImageMap[c]; break; }
                    }
                    if (!resolvedImageUrl) {
                        if (/^https?:\/\//i.test(raw) || raw.startsWith('data:')) {
                            resolvedImageUrl = raw;
                        }
                    }
                }
                
                // 创建新配件
                const newItem = {
                    id: Date.now() + i,
                    title: title,
                    description: description,
                    image: resolvedImageUrl,
                    features: features
                };
                
                // 添加到对应分类
                officeChairData[category].items.push(newItem);
                added.push({ category: categoryText, title });
            }
            
            return added;
        }

        // 数据持久化：保存到localStorage
        function saveDataToStorage() {
            try {
                localStorage.setItem('officeChairData', JSON.stringify(officeChairData));
                localStorage.setItem('officeChairUserModified', 'true');
                console.log('数据已保存到localStorage，标记为用户修改');
            } catch (error) {
                console.error('保存数据失败:', error);
            }
        }

        // 数据持久化：从localStorage加载
        function loadDataFromStorage() {
            try {
                const savedData = localStorage.getItem('officeChairData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    // 检查是否有用户修改标记
                    const hasUserModifications = localStorage.getItem('officeChairUserModified');
                    
                    if (hasUserModifications === 'true') {
                        // 如果用户已经修改过数据，直接使用保存的数据
                        window.officeChairData = parsedData;
                        console.log('已从localStorage加载用户修改后的数据');
                    } else {
                        // 首次加载，合并默认数据和新上传的数据
                        for (const categoryKey in parsedData) {
                            if (officeChairData[categoryKey] && parsedData[categoryKey].items) {
                                // 保留默认数据，只添加新上传的数据
                                const defaultItems = officeChairData[categoryKey].items;
                                const savedItems = parsedData[categoryKey].items;
                                
                                // 创建一个映射来避免重复
                                const existingTitles = new Set(defaultItems.map(item => item.title));
                                
                                // 只添加不在默认数据中的项目
                                const newItems = savedItems.filter(item => !existingTitles.has(item.title));
                                
                                // 合并数据：默认数据 + 新上传的数据
                                officeChairData[categoryKey].items = [...defaultItems, ...newItems];
                                
                                console.log(`分类 ${categoryKey} 合并数据: 默认${defaultItems.length}个 + 新增${newItems.length}个 = 总计${officeChairData[categoryKey].items.length}个`);
                            }
                        }
                        console.log('已从localStorage加载并合并数据');
                    }
                    return true;
                }
            } catch (error) {
                console.error('加载数据失败:', error);
            }
            return false;
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 从localStorage加载数据
            loadDataFromStorage();
            
            console.log('办公椅配件页面已加载');
            
            // 确保页面操作按钮正常工作
            console.log('页面操作按钮已初始化');
            
            // 为所有分类卡片添加调试事件监听器
            const categoryCards = document.querySelectorAll('.category-card');
            console.log('找到分类卡片数量:', categoryCards.length);
            categoryCards.forEach((card, index) => {
                card.addEventListener('click', function(e) {
                    console.log('分类卡片被点击了:', e.target, '索引:', index);
                });
            });
            
            // 测试showCategory函数是否可用
            console.log('showCategory函数是否可用:', typeof showCategory === 'function');
            console.log('officeChairData是否可用:', typeof officeChairData !== 'undefined');
            if (typeof officeChairData !== 'undefined') {
                console.log('officeChairData的键:', Object.keys(officeChairData));
            }
            
            // 测试编辑配件本地图片上传字段是否存在
            setTimeout(() => {
                const testElement = document.getElementById('editItemImageFile');
                console.log('编辑配件本地图片上传字段测试:', testElement);
                if (testElement) {
                    console.log('✅ 编辑配件本地图片上传字段存在');
                } else {
                    console.log('❌ 编辑配件本地图片上传字段不存在');
                }
            }, 1000);
        });

        // 显示配件详情
        window.showItemDetail = function(categoryKey, itemIndex) {
            console.log('showItemDetail called with category:', categoryKey, 'index:', itemIndex);
            
            const categoryData = window.officeChairData[categoryKey];
            if (!categoryData || !categoryData.items || !categoryData.items[itemIndex]) {
                console.error('Item not found for category:', categoryKey, 'index:', itemIndex);
                return;
            }
            
            const item = categoryData.items[itemIndex];
            console.log('Found item:', item);
            
            const modal = document.getElementById('itemDetailModal');
            const title = document.getElementById('itemDetailTitle');
            const body = document.getElementById('itemDetailBody');
            
            if (!modal || !title || !body) {
                console.error('Modal elements not found:', { modal, title, body });
                return;
            }
            
            title.textContent = item.title;
            body.innerHTML = `
                ${item.image ? `
                    <div class="item-image">
                        <img src="${item.image}" alt="${item.title}" data-image-src="${item.image}" onerror="this.style.display='none'" style="cursor: zoom-in;" title="点击放大图片" />
                    </div>
                ` : ''}
                <div class="item-detail">
                    <h3>配件描述</h3>
                    <p>${item.description}</p>
                </div>
                
                ${item.features && item.features.length > 0 ? `
                    <div class="detail-section">
                        <h4>主要特性</h4>
                        <div class="detail-tags">
                            ${item.features.map(feature => 
                                `<span class="detail-tag">${feature}</span>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="event.stopPropagation(); showEditItemModal('${categoryKey}', ${itemIndex});">
                        <i class="fas fa-edit"></i> 编辑
                    </button>
                    <button class="btn btn-danger" onclick="event.stopPropagation(); deleteItemConfirm('${categoryKey}', ${itemIndex});">
                        <i class="fas fa-trash"></i> 删除
                    </button>
                    <button class="btn btn-secondary" onclick="event.stopPropagation(); closeItemDetailModal();">
                        关闭
                    </button>
                </div>
            `;
            
            modal.style.display = 'flex';
            modal.style.zIndex = '99999';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            document.body.style.overflow = 'hidden';
            
            console.log('Item detail modal shown');
            
            // 确保按钮可以点击
            setTimeout(() => {
                const buttons = modal.querySelectorAll('.modal-footer button');
                console.log('Modal buttons found:', buttons.length);
                buttons.forEach((button, index) => {
                    console.log(`Button ${index}:`, button.textContent, 'onclick:', button.onclick);
                    button.style.pointerEvents = 'auto';
                    button.style.cursor = 'pointer';
                    button.style.zIndex = '100000';
                });
            }, 100);
        };

        // 关闭配件详情模态框
        window.closeItemDetailModal = function() {
            const modal = document.getElementById('itemDetailModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                console.log('Item detail modal closed');
            }
        };

        // 显示编辑配件模态框
        window.showEditItemModal = function(categoryKey, itemIndex) {
            console.log('showEditItemModal called with category:', categoryKey, 'index:', itemIndex);
            
            const categoryData = window.officeChairData[categoryKey];
            if (!categoryData || !categoryData.items || !categoryData.items[itemIndex]) {
                console.error('Item not found for editing');
                return;
            }
            
            const item = categoryData.items[itemIndex];
            
            // 关闭详情模态框
            closeItemDetailModal();
            
            // 填充编辑表单
            document.getElementById('editItemTitle').value = item.title;
            document.getElementById('editItemDescription').value = item.description;
            document.getElementById('editItemImage').value = item.image || '';
            
            // 设置隐藏字段
            document.getElementById('editItemCategory').value = categoryKey;
            document.getElementById('editItemIndex').value = itemIndex;
            
            // 设置功能特性
            const featuresContainer = document.getElementById('featuresContainer');
            if (featuresContainer && item.features) {
                featuresContainer.innerHTML = '';
                item.features.forEach(feature => {
                    addFeatureInput(feature);
                });
            }
            
            // 显示编辑模态框
            const editModal = document.getElementById('editItemModal');
            if (editModal) {
                editModal.classList.add('show');
                editModal.style.display = 'flex';
                
                // 使用CSS类锁定背景滚动
                const body = document.body;
                const html = document.documentElement;
                const scrollY = window.scrollY;
                
                // 同时锁定html和body元素
                html.classList.add('body-scroll-locked');
                body.classList.add('body-scroll-locked');
                body.style.top = `-${scrollY}px`;
                html.style.top = `-${scrollY}px`;
                
                // 保存滚动位置以便恢复
                body.dataset.scrollY = scrollY.toString();
                html.dataset.scrollY = scrollY.toString();
                
                // 强制启用模态框滚动
                setTimeout(() => {
                    const modalBody = editModal.querySelector('.modal-body');
                    if (modalBody) {
                        // 强制设置滚动样式
                        modalBody.style.cssText = `
                            padding: 30px !important;
                            flex: 1 !important;
                            overflow-y: scroll !important;
                            overflow-x: hidden !important;
                            min-height: 0 !important;
                            height: calc(80vh - 180px) !important;
                            max-height: calc(80vh - 180px) !important;
                            position: relative !important;
                            scroll-behavior: smooth !important;
                            -webkit-overflow-scrolling: touch !important;
                            scrollbar-width: thin !important;
                            pointer-events: auto !important;
                            touch-action: auto !important;
                        `;
                        
                        // 强制启用滚动事件
                        modalBody.addEventListener('wheel', function(e) {
                            e.stopPropagation();
                        }, { passive: false });
                        
                        console.log('模态框滚动已强制启用');
                        console.log('模态框高度设置:', modalBody.style.height);
                        console.log('模态框滚动状态:', modalBody.scrollHeight > modalBody.clientHeight);
                    }
                }, 100);
                
                // 保存当前编辑的配件信息
                window.currentEditCategory = categoryKey;
                window.currentEditIndex = itemIndex;
                
                console.log('Edit item modal shown');
            }
        };

        // 删除配件确认
        window.deleteItemConfirm = function(categoryKey, itemIndex) {
            const categoryData = window.officeChairData[categoryKey];
            if (!categoryData || !categoryData.items || !categoryData.items[itemIndex]) {
                console.error('Item not found for deletion');
                return;
            }
            
            const item = categoryData.items[itemIndex];
            const confirmDelete = confirm(`确定删除 "${item.title}" 吗？该操作不可恢复。`);
            
            if (confirmDelete) {
                // 删除配件
                categoryData.items.splice(itemIndex, 1);
                
                // 保存数据
                saveDataToStorage();
                
                // 重新渲染配件列表
                window.renderItems(categoryData.items);
                
                // 关闭详情模态框
                closeItemDetailModal();
                
                console.log('Item deleted:', item.title);
            }
        };

        // 保存编辑的配件
        window.saveEditedItem = function() {
            const title = document.getElementById('editItemTitle').value.trim();
            const description = document.getElementById('editItemDescription').value.trim();
            const imageUrl = document.getElementById('editItemImage').value.trim();
            
            if (!title || !description) {
                alert('请填写配件名称和描述');
                return;
            }
            
            // 获取功能特性
            const featureInputs = document.querySelectorAll('#featuresContainer .feature-input-item input');
            const features = Array.from(featureInputs)
                .map(input => input.value.trim())
                .filter(feature => feature);
            
            // 更新数据
            const categoryData = window.officeChairData[window.currentEditCategory];
            const item = categoryData.items[window.currentEditIndex];
            
            item.title = title;
            item.description = description;
            item.image = imageUrl;
            item.features = features;
            
            // 保存到localStorage
            saveDataToStorage();
            
            // 重新渲染配件列表
            window.renderItems(categoryData.items);
            
            // 关闭编辑模态框
            closeEditItemModal();
            
            console.log('Item saved:', item.title);
        };

        // 关闭编辑配件模态框
        window.closeEditItemModal = function() {
            const editModal = document.getElementById('editItemModal');
            if (editModal) {
                editModal.style.display = 'none';
                editModal.classList.remove('show');
                
                // 恢复背景滚动和位置
                const body = document.body;
                const html = document.documentElement;
                const scrollY = body.dataset.scrollY || '0';
                
                // 移除锁定类并重置样式
                html.classList.remove('body-scroll-locked');
                body.classList.remove('body-scroll-locked');
                body.style.top = '';
                html.style.top = '';
                
                // 恢复滚动位置
                window.scrollTo(0, parseInt(scrollY));
                
                // 清理数据
                delete body.dataset.scrollY;
                delete html.dataset.scrollY;
                
                console.log('Edit item modal closed');
            }
        };

        // 添加功能特性输入框
        window.addFeatureInput = function(value = '') {
            const container = document.getElementById('featuresContainer');
            if (!container) return;
            
            const featureItem = document.createElement('div');
            featureItem.className = 'feature-input-item';
            featureItem.innerHTML = `
                <input type="text" placeholder="输入功能特性" value="${value}">
                <button type="button" class="btn btn-sm btn-danger" onclick="removeFeatureInput(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(featureItem);
        };

        // 移除功能特性输入框
        window.removeFeatureInput = function(button) {
            const container = button.closest('.feature-input-item');
            if (container) {
                container.remove();
            }
        };

        // 点击模态框外部关闭
        document.addEventListener('click', function(e) {
            if (e.target.id === 'itemDetailModal') {
                closeItemDetailModal();
            }
            if (e.target.id === 'editItemModal') {
                closeEditItemModal();
            }
        });

        // 保存数据到localStorage
        window.saveDataToStorage = function() {
            try {
                localStorage.setItem('officeChairData', JSON.stringify(window.officeChairData));
                console.log('Data saved to localStorage');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        };

        // 从localStorage加载数据
        window.loadDataFromStorage = function() {
            try {
                const savedData = localStorage.getItem('officeChairData');
                if (savedData) {
                    window.officeChairData = JSON.parse(savedData);
                    console.log('Data loaded from localStorage');
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        };

        // 测试按钮点击功能
        window.testModalButtons = function() {
            console.log('Testing modal buttons...');
            const modal = document.getElementById('itemDetailModal');
            if (modal && modal.style.display === 'flex') {
                const buttons = modal.querySelectorAll('.modal-footer button');
                console.log('Found buttons:', buttons.length);
                buttons.forEach((button, index) => {
                    console.log(`Button ${index}:`, button.textContent.trim());
                    // 手动触发点击事件测试
                    button.addEventListener('click', function(e) {
                        console.log('Button clicked:', e.target.textContent.trim());
                        e.preventDefault();
                        e.stopPropagation();
                            });
                        });
            } else {
                console.log('Modal not found or not visible');
            }
        };

        // 强制修复按钮点击问题
        window.fixModalButtons = function() {
            const modal = document.getElementById('itemDetailModal');
            if (modal) {
                const buttons = modal.querySelectorAll('.modal-footer button');
                buttons.forEach(button => {
                    // 移除所有现有的事件监听器
                    const newButton = button.cloneNode(true);
                    button.parentNode.replaceChild(newButton, button);
                    
                    // 重新绑定事件
                    const text = newButton.textContent.trim();
                    if (text.includes('编辑')) {
                        newButton.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Edit button clicked');
                            // 这里应该调用编辑函数
                        };
                    } else if (text.includes('删除')) {
                        newButton.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Delete button clicked');
                            // 这里应该调用删除函数
                        };
                    } else if (text.includes('关闭')) {
                        newButton.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Close button clicked');
                            closeItemDetailModal();
                        };
                    }
                    
                    newButton.style.pointerEvents = 'auto';
                    newButton.style.cursor = 'pointer';
                    newButton.style.zIndex = '100000';
                });
                console.log('Modal buttons fixed');
            }
        };

        // 测试编辑模态框功能
        window.testEditModal = function() {
            console.log('Testing edit modal...');
            const modal = document.getElementById('editItemModal');
            if (modal) {
                console.log('Edit modal found:', modal);
                console.log('Modal display:', modal.style.display);
                console.log('Modal z-index:', modal.style.zIndex);
                
                const closeBtn = modal.querySelector('.close-btn');
                if (closeBtn) {
                    console.log('Close button found:', closeBtn);
                    console.log('Close button onclick:', closeBtn.onclick);
                    console.log('Close button pointer-events:', closeBtn.style.pointerEvents);
                }
                
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    console.log('Modal content found:', modalContent);
                    console.log('Modal content overflow:', modalContent.style.overflow);
                }
            } else {
                console.log('Edit modal not found');
            }
        };

        // 强制修复编辑模态框
        window.fixEditModal = function() {
            const modal = document.getElementById('editItemModal');
            if (modal) {
                // 修复关闭按钮
                const closeBtn = modal.querySelector('.close-btn');
                if (closeBtn) {
                    closeBtn.style.pointerEvents = 'auto';
                    closeBtn.style.cursor = 'pointer';
                    closeBtn.style.zIndex = '100000';
                    closeBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Close button clicked');
                        closeEditItemModal();
                    };
                }
                
                // 修复模态框滚动
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    modalContent.style.overflow = 'hidden';
                    modalContent.style.maxHeight = '80vh';
                    modalContent.style.display = 'flex';
                    modalContent.style.flexDirection = 'column';
                }
                
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    modalBody.style.overflowY = 'auto';
                    modalBody.style.overflowX = 'hidden';
                    modalBody.style.flex = '1';
                    modalBody.style.minHeight = '0';
                    modalBody.style.maxHeight = 'calc(80vh - 120px)';
                }
                
                console.log('Edit modal fixed');
            }
        };

        // 测试滚动功能
        window.testScroll = function() {
            const modal = document.getElementById('editItemModal');
            if (modal && modal.style.display === 'flex') {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    console.log('Modal body height:', modalBody.scrollHeight);
                    console.log('Modal body client height:', modalBody.clientHeight);
                    console.log('Can scroll:', modalBody.scrollHeight > modalBody.clientHeight);
                    
                    // 添加一些测试内容来强制滚动
                    const testContent = document.createElement('div');
                    testContent.innerHTML = `
                        <div style="height: 200px; background: #f0f0f0; margin: 10px 0; padding: 20px; border: 1px solid #ccc;">
                            <h4>测试滚动内容 1</h4>
                            <p>这是一些测试内容，用来测试滚动功能是否正常工作。</p>
                        </div>
                        <div style="height: 200px; background: #e0e0e0; margin: 10px 0; padding: 20px; border: 1px solid #ccc;">
                            <h4>测试滚动内容 2</h4>
                            <p>如果能看到这些内容，说明滚动功能正常工作。</p>
                        </div>
                        <div style="height: 200px; background: #d0d0d0; margin: 10px 0; padding: 20px; border: 1px solid #ccc;">
                            <h4>测试滚动内容 3</h4>
                            <p>请尝试滚动查看这些测试内容。</p>
                        </div>
                    `;
                    modalBody.appendChild(testContent);
                    
                    console.log('Test content added, new height:', modalBody.scrollHeight);
                }
                } else {
                console.log('Edit modal not visible');
            }
        };

        // 清除测试内容
        window.clearTestContent = function() {
            const modal = document.getElementById('editItemModal');
            if (modal) {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    const testContent = modalBody.querySelector('div[style*="background: #f0f0f0"]');
                    if (testContent) {
                        testContent.remove();
                    }
                    console.log('Test content cleared');
                }
            }
        };

        // 测试保存按钮功能
        window.testSaveButton = function() {
            console.log('Testing save button...');
            
            // 检查隐藏字段
            const categoryKey = document.getElementById('editItemCategory').value;
            const itemIndex = document.getElementById('editItemIndex').value;
            console.log('Category key:', categoryKey);
            console.log('Item index:', itemIndex);
            
            // 检查表单字段
            const title = document.getElementById('editItemTitle').value;
            const description = document.getElementById('editItemDescription').value;
            const imageUrl = document.getElementById('editItemImage').value;
            console.log('Title:', title);
            console.log('Description:', description);
            console.log('Image URL:', imageUrl);
            
            // 检查功能特性
            const featureInputs = document.querySelectorAll('#featuresContainer .feature-input-item input');
            const features = Array.from(featureInputs).map(input => input.value.trim()).filter(feature => feature);
            console.log('Features:', features);
            
            // 检查数据
            console.log('Office chair data:', window.officeChairData);
            if (categoryKey && window.officeChairData[categoryKey]) {
                console.log('Category data:', window.officeChairData[categoryKey]);
                console.log('Item data:', window.officeChairData[categoryKey].items[itemIndex]);
            }
            
            // 手动调用保存函数
            if (title && description) {
                console.log('Calling saveItem function...');
                saveItem();
            } else {
                console.log('Missing required fields');
            }
        };

        // 强制修复保存按钮
        window.fixSaveButton = function() {
            const saveButton = document.querySelector('#editItemModal .btn-primary');
            if (saveButton) {
                console.log('Found save button:', saveButton);
                
                // 重新绑定点击事件
                saveButton.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Save button clicked');
                    saveItem();
                };
                
                saveButton.style.pointerEvents = 'auto';
                saveButton.style.cursor = 'pointer';
                saveButton.style.zIndex = '100000';
                
                console.log('Save button fixed');
            } else {
                console.log('Save button not found');
            }
        };

        // 强制修复背景滚动锁定
        window.fixBackgroundLock = function() {
            console.log('=== 强制修复背景滚动锁定 ===');
            const body = document.body;
            const html = document.documentElement;
            const scrollY = window.scrollY;
            
            // 强制锁定背景
            html.classList.add('body-scroll-locked');
            body.classList.add('body-scroll-locked');
            html.style.cssText = `
                overflow: hidden !important;
                position: fixed !important;
                width: 100% !important;
                height: 100% !important;
                top: -${scrollY}px !important;
                left: 0 !important;
                right: 0 !important;
            `;
            body.style.cssText = `
                overflow: hidden !important;
                position: fixed !important;
                width: 100% !important;
                height: 100% !important;
                top: -${scrollY}px !important;
                left: 0 !important;
                right: 0 !important;
            `;
            
            console.log('背景滚动已强制锁定');
            console.log('- HTML类名:', html.className);
            console.log('- Body类名:', body.className);
            console.log('- HTML位置:', html.style.position);
            console.log('- Body位置:', body.style.position);
            console.log('- 滚动位置:', scrollY);
        };

        // 强制修复模态框滚动
        window.fixModalScroll = function() {
            console.log('=== 强制修复模态框滚动 ===');
            const modal = document.getElementById('editItemModal');
            if (modal && modal.style.display === 'flex') {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    // 强制设置样式
                    modalBody.style.cssText = `
                        padding: 30px !important;
                        flex: 1 !important;
                        overflow-y: auto !important;
                        overflow-x: hidden !important;
                        min-height: 0 !important;
                        height: calc(80vh - 180px) !important;
                        max-height: calc(80vh - 180px) !important;
                        position: relative !important;
                        scroll-behavior: smooth !important;
                        -webkit-overflow-scrolling: touch !important;
                        scrollbar-width: thin !important;
                    `;
                    
                    console.log('模态框滚动样式已强制应用');
                    console.log('- 滚动高度:', modalBody.scrollHeight);
                    console.log('- 可见高度:', modalBody.clientHeight);
                    console.log('- 是否可以滚动:', modalBody.scrollHeight > modalBody.clientHeight);
                    
                    // 测试滚动
                    modalBody.scrollTop = 10;
                    setTimeout(() => {
                        console.log('- 当前滚动位置:', modalBody.scrollTop);
                        modalBody.scrollTop = 0;
                    }, 100);
                }
            } else {
                console.log('模态框未打开，请先打开编辑配件模态框');
            }
        };

        // 专门测试模态框内容滚动
        window.testModalContentScroll = function() {
            console.log('=== 专门测试模态框内容滚动 ===');
            const modal = document.getElementById('editItemModal');
            if (modal && modal.style.display === 'flex') {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    console.log('模态框内容区域信息:');
                    console.log('- 滚动高度:', modalBody.scrollHeight);
                    console.log('- 可见高度:', modalBody.clientHeight);
                    console.log('- 偏移高度:', modalBody.offsetHeight);
                    console.log('- 是否可以滚动:', modalBody.scrollHeight > modalBody.clientHeight);
                    console.log('- 当前滚动位置:', modalBody.scrollTop);
                    
                    // 强制添加更多内容来测试滚动
                    const testContent = document.createElement('div');
                    testContent.innerHTML = `
                        <div style="height: 200px; background: linear-gradient(135deg, #667eea, #764ba2); margin: 20px 0; padding: 20px; color: white; border-radius: 10px;">
                            <h3>测试滚动内容 1</h3>
                            <p>这是第一个测试块，用来验证模态框内容滚动功能。</p>
                        </div>
                        <div style="height: 200px; background: linear-gradient(135deg, #f093fb, #f5576c); margin: 20px 0; padding: 20px; color: white; border-radius: 10px;">
                            <h3>测试滚动内容 2</h3>
                            <p>这是第二个测试块，如果你能看到这个内容，说明滚动功能正常。</p>
                        </div>
                        <div style="height: 200px; background: linear-gradient(135deg, #4facfe, #00f2fe); margin: 20px 0; padding: 20px; color: white; border-radius: 10px;">
                            <h3>测试滚动内容 3</h3>
                            <p>这是第三个测试块，请尝试滚动查看这些内容。</p>
                        </div>
                    `;
                    modalBody.appendChild(testContent);
                    
                    console.log('测试内容已添加');
                    console.log('- 新的滚动高度:', modalBody.scrollHeight);
                    console.log('- 新的可见高度:', modalBody.clientHeight);
                    console.log('- 现在可以滚动:', modalBody.scrollHeight > modalBody.clientHeight);
                    
                    // 测试滚动功能
                    if (modalBody.scrollHeight > modalBody.clientHeight) {
                        console.log('✅ 模态框内容可以滚动！');
                        modalBody.scrollTop = 50;
                        setTimeout(() => {
                            console.log('- 滚动测试位置:', modalBody.scrollTop);
                            modalBody.scrollTop = 0;
                        }, 500);
                    } else {
                        console.log('❌ 模态框内容仍然不能滚动');
                    }
                }
            } else {
                console.log('模态框未打开，请先打开编辑配件模态框');
            }
        };

        // 测试模态框滚动功能
        window.testModalScroll = function() {
            console.log('=== 测试模态框滚动功能 ===');
            const modal = document.getElementById('editItemModal');
            if (modal && modal.style.display === 'flex') {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    console.log('模态框主体信息:');
                    console.log('- 滚动高度:', modalBody.scrollHeight);
                    console.log('- 可见高度:', modalBody.clientHeight);
                    console.log('- 偏移高度:', modalBody.offsetHeight);
                    console.log('- 是否可以滚动:', modalBody.scrollHeight > modalBody.clientHeight);
                    
                    console.log('页面body状态:');
                    console.log('- Body类名:', document.body.className);
                    console.log('- Body位置:', document.body.style.position);
                    console.log('- Body溢出:', document.body.style.overflow);
                    console.log('- Body顶部:', document.body.style.top);
                    
                    // 添加测试内容
                    const testDiv = document.createElement('div');
                    testDiv.innerHTML = `
                        <div style="height: 300px; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); margin: 20px 0; padding: 20px; color: white; border-radius: 10px;">
                            <h3>测试滚动内容</h3>
                            <p>这是一个测试块，用来验证模态框滚动功能。</p>
                            <p>如果你能看到这个内容并且可以滚动，说明滚动功能正常。</p>
                        </div>
                    `;
                    modalBody.appendChild(testDiv);
                    
                    console.log('测试内容已添加，新的滚动高度:', modalBody.scrollHeight);
                }
            } else {
                console.log('模态框未打开，请先打开编辑配件模态框');
            }
        };

        // 强制启用模态框滚动
        window.forceEnableModalScroll = function() {
            console.log('=== 强制启用模态框滚动 ===');
            const modal = document.getElementById('editItemModal');
            if (modal && modal.style.display === 'flex') {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    // 移除所有可能阻止滚动的样式
                    modalBody.style.removeProperty('pointer-events');
                    modalBody.style.removeProperty('touch-action');
                    
                    // 强制设置滚动样式
                    modalBody.style.cssText = `
                        padding: 30px !important;
                        flex: 1 !important;
                        overflow-y: scroll !important;
                        overflow-x: hidden !important;
                        min-height: 0 !important;
                        height: calc(80vh - 180px) !important;
                        max-height: calc(80vh - 180px) !important;
                        position: relative !important;
                        scroll-behavior: smooth !important;
                        -webkit-overflow-scrolling: touch !important;
                        scrollbar-width: thin !important;
                        pointer-events: auto !important;
                        touch-action: auto !important;
                    `;
                    
                    // 强制启用滚动事件
                    modalBody.addEventListener('wheel', function(e) {
                        e.stopPropagation();
                    }, { passive: false });
                    
                    modalBody.addEventListener('touchmove', function(e) {
                        e.stopPropagation();
                    }, { passive: false });
                    
                    console.log('强制滚动样式已应用');
                    console.log('- 滚动高度:', modalBody.scrollHeight);
                    console.log('- 可见高度:', modalBody.clientHeight);
                    console.log('- 是否可以滚动:', modalBody.scrollHeight > modalBody.clientHeight);
                    
                    // 强制测试滚动
                    modalBody.scrollTop = 100;
                    setTimeout(() => {
                        console.log('- 强制滚动测试位置:', modalBody.scrollTop);
                        if (modalBody.scrollTop > 0) {
                            console.log('✅ 强制滚动成功！');
                            modalBody.scrollTop = 0;
                        } else {
                            console.log('❌ 强制滚动失败');
                        }
                    }, 100);
                }
            } else {
                console.log('模态框未打开，请先打开编辑配件模态框');
            }
        };

    </script>
</body>
</html>
